

# Стратегичeский DDD

Ссылка на урок: https://lms.tough-dev.school/materials/53ef43c8fff14a65be8caa420b75329b

# Выделяем субдомены
Использую вариант деления на субдомены:
1. по организационной структуре (точнее по ролям "заказчиков")
2. функции внутри подразделений

| Подразделение    | Функция                               | Субдомен                            | Комментарий                                                                                                                                                                                                                                                                                                                                                                                                |
| ---------------- | ------------------------------------- | ----------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Клиентский отдел | Управление заказами                   | Управление заказами                 | Данный субдомен я выделил как интерфейс для взаимодействия с клиентами в части формирования заказов (создания, отмены, копирования/установки новой даты).<br>Если же в будущем появятся другие способы получения заказов, то далее планируется выделять отдельный субдомен на каждый способ.                                                                                                               |
|                  | Контроль заказов                      | Контроль заказов                    | Тут будет определена логика по работе с задачами на контроль заказов. Домен выделег отдельно потому, что эта логика "живет своей жизнью" и не должна влиять на процессы управления заказами (по крайней мере явно, допускаю, что в будущем рещультаты контроля могут быть использованы и в формировании заказов и в производстве)                                                                          |
|                  |                                       | Тотализатор                         | Выделен отдельно, так как также своя логика.<br>Отнесен к клиентскому отделу, так как главные участники - менеджеры                                                                                                                                                                                                                                                                                        |
| Производство     | Исполнение заказов воркерами          | Исполнение заказов                  | Тут также своя логика, причем исполнение заказа не зависит от того, как был получен заказ.                                                                                                                                                                                                                                                                                                                 |
| Склад            | Комплектование заказов расходниками   | Комплектование заказов расходниками | Также своя логика, хотя она и действует в рамках логики исполнения заказами.<br>Но если в будущем будет реинжиниринг процессов, то это не должно влиять непосредственно на выполнение заказа - то есть, неважно как, но заказ должен быть укомплектован в срок.                                                                                                                                            |
|                  | Взаимодействие с поставщиками печенья | Взаимодействие с поставщиками       | Побочная логика, которая не должна влиять на логику формирования заказа расходниками. Но при этом должна ей подчиняться (хотя если изменят технологию заказа и доставки печенья, то может дить своей жизнью).<br>Также в дальнейшем для каждого поставщика расходников могут быть выделены свои субдомены.                                                                                                 |
| Финансовый отдел | Расчет оплаты по заказам (биллинг)    | Биллинг                             | Здесь соредоточены операции биллинга - т.е. финансовых расчетов по заказам для клиентов                                                                                                                                                                                                                                                                                                                    |
|                  | Платежи                               | Расчеты с клиентами                 | Платежи клиентам выделены отдельно от финансовых расчетов, так как тут своя специфика. пчущихся на груди хозяина).  Но при этом способы оплаты не должны влиять на расчеты по заказам (и наоборот)<br>При этом в требованиях говорится, что у клиентам есть много разхных способов оплаты - тут возможно, что для каждого способа может быть выделен еще субдомен (но тут пока решил остановиться на этом) |
|                  | Расчеты оплаты труда                  | Оплата труда воркерам               | В отличии от биллинга здесь алгоритмы расчета оплаты воркерам<br>Отделяем от биллинга, так как тут могут быть свои достаточно специфические особенности (теоретически, могут быть добавлены требования по налогам).                                                                                                                                                                                        |
|                  | Платежи воркерам                      | Платежи воркерам                    | Также как в расчетах с клиентами - это отдельный процесс (причем достаточно стандартный)<br>Причем также может быть расширение в дальнейшем - будут новые способы оплаты (например, для международной оплаты специальных сиамских котов воркеров идеально то                                                                                                                                               |
| HR               | Наем воркеров                         | Наем воркеров                       | Отдельный процесс не связанный с заказами.                                                                                                                                                                                                                                                                                                                                                                 |
# Определяем типы субдоменов

| Субдомен                            | Конкурентное преймущество                                                                                  | Сложность доменной модели                                                            | Изменчивость                                                                                                                             | Вариант реализации                | Интерес проблемы | Предполагаемый вид субдомена                                                                                                                                                                                                                                       |
| ----------------------------------- | ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Управление заказами                 | нет                                                                                                        | сложная                                                                              | частая                                                                                                                                   | inhouse                           | высокий          | generic                                                                                                                                                                                                                                                            |
| Контроль заказов                    | нет                                                                                                        | низкая                                                                               | частая                                                                                                                                   | inhouse                           | низкий           | generic<br>пока, если смотреть требования, здесь достаточно обычный процесс работы с задачами, что-то типа Jira<br>но возможно, если появятся какие-нибудь требования к автоанализу с уникальными алгоритмами, то тут скорее всего тип субдомена может стать  core |
| Тотализатор                         | нет                                                                                                        | низкая                                                                               | редкая                                                                                                                                   | ???                               | высокий          | supporting<br>хотя тема, как стимул, и интересная, но это больше поддержка основной деятельности<br>                                                                                                                                                               |
| Исполнение заказов                  | да<br>в требованиях сказано - что компания собирается стать лидером за счет эффективного матчинга          | сложная<br>                                                                          | редкая                                                                                                                                   | inhouse                           | высокий          | core<br>собственно, это основной процесс                                                                                                                                                                                                                           |
| Комплектование заказов расходниками | нет<br>                                                                                                    | низкая                                                                               | редкая                                                                                                                                   | купить                            | низкий           | generic<br>достаточно типовая задача работы склада<br>                                                                                                                                                                                                             |
| Взаимодействие с поставщиками       | нет                                                                                                        | низкая                                                                               | частая                                                                                                                                   | ???                               | низкий           | supporting<br>вспомогательный процесс к работе склада                                                                                                                                                                                                              |
| Биллинг                             | нет                                                                                                        | сложная<br>тут представлены сложные уникальные алгоритмы ~~обмана~~ расчета клиентов | частая<br>алгоритмя расчета могут и должны подстраваться по цели бизнеса                                                                 | inhouse                           | высокий          | core<br>тут уникальные алгоритмы обсчета клиентов по заказам и влияет на бизнес-компании (лучше считаем - больше получаем)                                                                                                                                         |
| Расчеты с клиентами                 | нет                                                                                                        | низкая                                                                               | редкая<br>в рамках одного способа оплаты изменений почти нет (а добавление нового способа оплаты лучше оформлять как отдельный субдомен) | inhouse                           | низкий           | supporting<br>вспомогательный процесс к работе биллинга                                                                                                                                                                                                            |
| Оплата труда воркерам               | нет                                                                                                        | сложная<br>также слоджные алгоритмы оплаты воркерам                                  | частая<br>также видится, что алгоритмы могут меняться для повышения конкуретности компании на рынке труда воркеров                       | inhouse                           | высокий          | core<br>также уникальные алгоритмы расчеты оплаты труда воркеров                                                                                                                                                                                                   |
| Платежи воркерам                    | нет                                                                                                        | низкая                                                                               | редкая                                                                                                                                   | аутсорс (отдадим в Золотую шляпу) | низкий           | supporting<br>вспомогательный процесс к работе оплаты труда                                                                                                                                                                                                        |
| Наем воркеров                       | да<br>в требованиях сказано - что компания собирается стать лидером в том числе и за счет подбора воркеров | низкая                                                                               | редкая                                                                                                                                   | inhouse                           | низкий           | core<br>                                                                                                                                                                                                                                                           |

# Выделяем контекст

| Субдомен                            | Тип субдомена | Выделенный боундед-контекст        | Комментарий                                                                                                                                                                                                                                                                                                                                                                                                      |
| ----------------------------------- | ------------- | ---------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Управление заказами                 | core          | Личный кабинет клиента             |                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Контроль заказов                    | generic       | Задачи контроля заказов            |                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Тотализатор                         | supporting    | Ставки на заказы                   |                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Исполнение заказов                  | core          | Исполнение заказов                 |                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Комплектование заказов расходниками | generic       | Комплектование заказов             |                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Взаимодействие с поставщиками       | supporting    | Работа заказами расходников        | В данном случае выделяется отдлеьный контекст работы с поставщиками<br>Изначально хотел выделить еще работу с поставщиком печенья, но решил, что на данном этапе не стоит усложнять логику. Хотя в дальнейшем при появлении новых поставщиков могут возникнуть проблемы и придется разделять логику на общую логику работы с поставщиками и логику, специфическую для взаимодействия с определенным поставщиком. |
| Биллинг                             | core          | Биллинг по заказам                 |                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Расчеты с клиентами                 | supporting    | Прием платежей от клиентов         | Так как в требованиях не определены конретные способы оплаты счета клиентом, то пока ограничиваемся один контекстом.<br>В дальнейшем монут появиться контексты для каждого способа оплаты (если конечно не возникнет необходимость в субдоменах)                                                                                                                                                                 |
| Оплата труда воркерам               | core          | Расчеты с воркерами                |                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Платежи воркерам                    | supporting    | Платежи воркерам                   | Также тут контекст для логики отправки платежей.<br>Как и в случае с работой с поставщиками - не выделяем отдельно общую логику и логику взаимодействия с Золотой шляпой (хотя при появлении новых платежных систем  возможно придется выделять).                                                                                                                                                                |
| Наем воркеров                       | supporting    | Работа с вакансиями котов-воркеров | Тут контекст работы с вакансиями котов-воркеров и связаными с ними задачами - прием и рассмотрения заявок от кандидатов                                                                                                                                                                                                                                                                                          |
# Выявление различий с первичной ES моделью

| Первоначальный контекст       | Полученные контекст*          | Предполагаемая причина несоответствия                                                                                                                                                                                                                                                                                                                                        |
| ----------------------------- | ----------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Управление заказами на услуги | Личный кабинет клиента        | В данном случае разделение контекста произошло, потому что логика диктовалась разными заказчиками:<br>- личный кабинет клиента (т.е. непосредственное взаимодейстие с клиентом в части заказов) - менеджерами<br>- исполнение заказов - воркерами (т.е. им виднее как они будут исполнять услугу и в дальнейшем они и будут диктовать требования по изменению логики задачи) |
|                               | Исполненение заказов          |                                                                                                                                                                                                                                                                                                                                                                              |
| Комплектация заказа           | Комплектование заказов        | Был выделена работа с заказом расходников (в частности с поставщиком печенья).<br>Тут тоже причина в том, что в прицнипе требования также могут быть распределены на двух "заказчиков" - то есть сами комплектовщики заказов, а могут еще и появится снабженцы.                                                                                                              |
|                               | Работа с заказами расходников |                                                                                                                                                                                                                                                                                                                                                                              |
| Аккаунтинг                    | Биллинг по заказам            | Та же самамя причина - после анализа выявились разные "роли" заказчиков.                                                                                                                                                                                                                                                                                                     |
|                               | Прием платежей от клиентов    |                                                                                                                                                                                                                                                                                                                                                                              |
|                               | Оплата труда воркерам         |                                                                                                                                                                                                                                                                                                                                                                              |
|                               | Платежи воркерам              |                                                                                                                                                                                                                                                                                                                                                                              |
| Контроль качества заказов     | Задачи контроля заказов       |                                                                                                                                                                                                                                                                                                                                                                              |
| Управление воркерами          | Найм воркеров                 |                                                                                                                                                                                                                                                                                                                                                                              |
| Тотализатор                   | Ставки на заказы              |                                                                                                                                                                                                                                                                                                                                                                              |

# Уменьшаем связанность

| Связь                                                                                                                        | Новое решение                                                                                  | Описание                                                                                                                                                                                                                                                      |
| ---------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Оплата воркеру начислена -> Отправить инвойс воркеру                                                                         | Оплата воркеру насчислена                                                                      | Инвойс воркеру всегда отправляется после расчета начислений, так что можно считать считать, что инвойс воркеру является частью операции начисления.                                                                                                           |
| Оплата воркеру начислена (контекст:  Оплата труда воркерам) -> Перечислить средства воркеру (контекст: Платежи воркерам)     | Все из контекста "Платежи воркерам" перенести в контекст "Оплата труда воркерам"               | На данный момент все-таки нет какой-то особенной логики по платежам воркерам, поэтому пока это можно сделать частью контекста (тем более сам платеж реализуется Золотой шляпой)<br>Но с развитием логики платежей скорее всего потребуется отдельный контекст |
| Заказ на расходники создан (контекст: Комплектование заказов) -> Заказать печенье (контекст: Работа с заказам и расходников) | Все из контекста "Работа с заказами расходников" перенести в контекст "Комплектование заказов" | Такая же причина - для отдельного контекста по работе с поставщиками пока очень мало специфической логики (к тому же там вся логика сейчас внутри сервиса компании по производству печенья), а прямая связь есть.                                             |
| Клиенту начислена оплата за услуги -> Отправить инвойс клиенту                                                               | Клиенту начислена оплата за услуги                                                             | Также в рамках начисления клиенту можно отправить и инвойс                                                                                                                                                                                                    |
|                                                                                                                              |                                                                                                |                                                                                                                                                                                                                                                               |
# Характеристики системы (оценка по требованиям и выявление неявных характеристик)

| Характеристика                       | Описание                                                                                                                                                      | Личный кабинет                                        | Исполнение заказов                     | Биллинг по заказам                                    | Комплектование заказов         | Оплата труда воркерам | Задачи контроля заказов | Ставки на заказы | Работа с вакансиями воркеров                       |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------- | -------------------------------------- | ----------------------------------------------------- | ------------------------------ | --------------------- | ----------------------- | ---------------- | -------------------------------------------------- |
| Availability (доступность)           | Измеряет отказы системы и их последствия                                                                                                                      | | Цели: 24                                            | Цели: В рабочее время                  |                                                       |                                |                       |                         |                  | Цели: 24x7 (чтобы не упустить выгодных кандидатов) |
| Scalability (масштабируемость)       | Насколько система справляется с ростом нагрузки (средней, а не пиковой)                                                                                       | ТЗ: 10 заказов в день<br>ТЗ: 100 пользователей в день | ТЗ: 20 воркеров                        |                                                       |                                |                       |                         | 15 пользователей | 1000 заявок в день                                 |
| Modifiability (изменяемость)         | Цена и риски изменений системы                                                                                                                                |                                                       | ТЗ: Планируется новая система матчинга | ТЗ: Планируется изменение алгоритма расчета стоимости |                                |                       |                         |                  |                                                    |
| Maintainability (обслуживаемость)    | Ремонтопригодность — сложность восстановления системы после поломок или изменения других характеристик                                                        |                                                       |                                        |                                                       |                                |                       |                         |                  |                                                    |
| Security (безопасность)              | Насколько система защищает информацию от несанкционированного доступа                                                                                         |                                                       |                                        |                                                       |                                |                       |                         |                  |                                                    |
| Performance (производительность)     | Время, за которое система реагирует на действия пользователей или других систем                                                                               |                                                       |                                        |                                                       | 10 минут на готовность печенья |                       |                         |                  |                                                    |
| Agility (гибкость, подстраиваемость) | Составная характеристика, которая обозначает «гибкость» системы — умение подстраиваться под изменения во внешнем мире                                         |                                                       |                                        |                                                       |                                |                       |                         |                  |                                                    |
| Testability (тестируемость)          | Характеризует простоту или полноту тестирования                                                                                                               |                                                       |                                        |                                                       |                                |                       |                         |                  |                                                    |
| Deployability (развертывание)        | Измеряет простоту и скорость деплоймента новой функциональности                                                                                               |                                                       |                                        |                                                       |                                |                       |                         |                  |                                                    |
| Usability (юзабельность)             | Характеризует эффективность и удобство взаимодействия людей с системой                                                                                        |                                                       |                                        |                                                       |                                |                       |                         |                  |                                                    |
| Consistency                          | Насколько система гарантирует возвращение актуального состояния после каждого чтения. Это когда все пользователи видят одинаковые данные в одно и то же время |                                                       |                                        |                                                       |                                |                       |                         |                  |                                                    |
| Simplicity (простота)                | Понятность системы для тех, кто с ней взаимодействует                                                                                                         |                                                       |                                        |                                                       |                                |                       |                         |                  |                                                    |

# Выбор стиля

|               | Монолит | Service-based | MSA |                                                                                                                                        |     |
| ------------- | ------- | ------------- | --- | -------------------------------------------------------------------------------------------------------------------------------------- | --- |
| agility       | 1       | 2             | 3   | Новый продукт, к тому же в требованиях явно говорится о возможности проверки гипотез                                                   |     |
| scalability   | 1       | 2             | 3   | Планируется рост клиентов (будут подключать не толко работников HCB)                                                                   |     |
| deployability | 1       | 2             | 2   | Вытекает из необходимости быстрого развертывания для пуска новых гипотез в работу (проверку)                                           |     |
| testability   | 1       | 2             | 2   | Вытекает из необходимости быстрого развертывания для пуска новых гипотез в работу (проверку)                                           |     |
| domain part   | 1       | 2             | 2   | В рамках системы есть четко выделенные группы домены, которые по сути являются разными: работа с заказами, финансы, наем воркеров (HR) |     |
| evolvability  | 1       | 2             | 3   | Фактически по каждому субдомену есть планы/перспективы развитию                                                                        |     |

**Решение**: будет использоваться  микросервисная архитектура

