# Изменение сервисов
Схема сервисов к домашке 1 (монолит): [link](https://github.com/cvartan/system-analysis/blob/main/homework4/Services%20%28homework1%29.drawio.png)

Схема сервисов к домашке 3 (финальный вариант, МСА): [link](https://github.com/cvartan/system-analysis/blob/main/homework4/Services%20%28homework3%29.drawio.png)

**Основное действие по изменению**: выделение новых сервисов.

| Сервис (домашка 1)           | Сервис (домашка 3)                    | Комментарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ---------------------------- | ------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Исполнение заказов (монолит) | Подбор воркеров на заказа             | Выделили core-поддомен                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                              | Взаимодействие с клиентами по заказам | Предпосылки - подключение внешних клиентов (не из HCB), а следовательно возможен более быстрый релизный цикли и изменяемость (подстройка под внешних клиентов). К тому же выросло количество обращений клиентов - надо обеспечивать более высокий performance для создания и копирования заказов.<br>На данном этапе проблемой является обратный поток от сервиса исполнения заказов в котором передается информация о проваленных заказах (которые клиент должен скопировать с установкой нового времени исполнения). |
|                              | Аккаунтинг                            | Выделение отдельного боунд-контекста<br>Консерн от финотдела по сохранению финансовой информации                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                              | Комплектование заказов                | Generic-поддомен (когда Исполнение заказов - supporting)<br>Выделение отдельного боунд-контекста                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                              | Контроль качества заказов             | Выделение отдельного поддомена и боунд-контекста<br>Другой тип БД - документарная (неформализованный набор данных)                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                              |

# Расчет instability для сервисов
## Instability для "новых" сервисов
| Сервис                                | Входящие связи (Ca)                                                                                                                               | Исходящие связи (Ce)                                                        | Instability сервиса |
| ------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------- | ------------------- |
| Взаимодействие с клиентами по заказам | 1: <br>Исполнение заказов                                                                                                                         | 3:<br>Подбор воркера на заказ<br>Аккаунтинг<br>Тотализатор (CUD по заказам) | 0,75                |
| Подбор воркера на заказ               | 1:<br>Взаимодействие с клиентами по заказам                                                                                                       | 2:<br>Исполнение заказов<br>Аккаунтинг<br>                                  | 0,67                |
| Аккаунтинг                            | 4:<br>Наем воркеров (CUD по воркерам)<br>Взаимодействие с клиентами по заказам (CUD по клиентам)<br>Исполнение заказов<br>Подбор воркера на заказ | 0                                                                           | 0                   |
| Комплектование заказов                | 1: Исполнение заказов                                                                                                                             | 0                                                                           | 0                   |
| Контроль качества заказов             | 1: Исполнение заказа                                                                                                                              | 0                                                                           | 0                   |

## Instability для связанных сервисов 
Указываются только те сервисы которых нет в списке выше
| Сервис             | Входящие связи (Ca)                                                                 | Исходящие связи (Ce)                                                                                  | Instability сервиса |
| ------------------ | ----------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- | ------------------- |
| Исполнение заказов | 2:<br>Подбор воркера на заказ<br>Наем воркеров (CUD по воркерам)                    | 4:<br>Аккаунтинг<br>Контроль качества заказов<br>Взаимодействие с клиентами по заказам<br>Тотализатор | 0,67                |
| Тотализатор        | 2: <br>Взаимодействие с клиентами по заказам (CUD по заказам)<br>Исполнение заказов | 0                                                                                                     | 0                   |

## План работ по распилу монолита
| Разделяемый сервис           | Когда свободных людей и ресурсов нет, а опыт и (или) инфраструктура есть                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Когда есть свободные люди и ресурсы, а опыта и (или) инфраструктуры нет                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Исполнение заказов (монолит) | 1. Выделяем подбор воркеров на заказы <br>Это core-домен, к тому же есть специфические требования к разработке.<br>Используемый шаблон: Change Data Capture (так как меняем еще и тип БД)<br><br>2. Выделяем сервис "Аккаунтинг"<br>Используем шаблон Strangler Fig Application<br><br>3. Выделяем сервис взаимодействия с клиентами <br>Используем шаблон Tactical Forking (два равноценных куска однорго сервиса)<br><br>4. Выделям сервис  контроля качества заказов<br>Используем шаблон  Change Data Capture (так как меняется тип БД<br><br>5.  Выделяем комплектование заказов<br>Используем шаблон Strangler Fig Application | 1. Выделяем контроль качества заказов (получается сервис который только получает данные, в принципе логика достаточно простая - просто работа с задачами). <br>Хотя субдомен - supporting, но логика контекста достаточно простая и влияния на бизнес меньше чем у комплектования заказов в generic-субдомене <br>Используем шаблон  Change Data Capture (так как меняется тип БД)<br><br>2. Выделяем комплектование заказов<br>Также получается сервис который только получает данные.<br>Домен - generic, что также говорит, что логика не будет сложной для реализации.<br>Используем шаблон Strangler Fig Application<br><br>3. Выделяем сервис "Аккаунтинг" <br>В данном случае также получаем блок только с входящими связями<br>Используем шаблон Strangler Fig Application<br><br>4. Выделяем подбор воркеров на заказы (матчинг)<br>Используемый шаблон: Change Data Capture (так как меняем еще и тип БД)<br><br>5. Выделяем сервис взаимодействия с клиентами<br>Используем шаблон Tactical Forking (так как разделяются равноценные сервисы) |
